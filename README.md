# Bubble Tea Production Pipeline Simulation

Моделирование конвейерной системы производства чайных напитков с тапиокой (Bubble Tea) в рамках лабораторной работы №7  
**“Многопоточность, асинхронность, моделирование конвейерной системы”**.

## Описание модели

Система имитирует процесс приёма и выполнения заказов в чайном кафе.  
Она состоит из **эмиттеров** (источников заказов), **очередей** и **обработчиков** (станций приготовления).  
Каждый элемент работает в отдельном потоке (или асинхронной задаче), обмениваясь данными через потокобезопасные очереди.

### 1. Эмиттеры (источники заказов)

| Тип заказа         | Интенсивность               | Атрибуты                                                                 |
|--------------------|-----------------------------|--------------------------------------------------------------------------|
| **Обычный**        | 1 заказ / 3 с ± 1.5 с       | • ID<br>• время создания<br>• сложность (1.0; 1.5; 2.0)<br>• количество топпингов (0–3)<br>• объём (500, 700, 1000 мл) |
| **Групповой**      | 1 заказ / 10 с ± 3 с        | • те же базовые атрибуты<br>• флаг `student_sale`<br>• количество штук   |

### 2. Очереди

| Очередь                     | Ёмкость         | Назначение                                                |
|-----------------------------|-----------------|-----------------------------------------------------------|
| **Обычная очередь заказов** | 35 ед. сложности| Все заказы поступают сюда перед обработкой.              |
| **Очередь на варку тапиоки**| 15 порций       | Ожидание готовности тапиоки. Варится непрерывно.         |
| **Очередь готовых напитков**| 12 напитков     | Напитки, готовые к выдаче. Групповые заказы комплектуются полностью. |

### 3. Обработчики (станции)

| Обработчик              | Производительность       | Вероятности исхода                                          |
|-------------------------|--------------------------|-------------------------------------------------------------|
| **Приготовление основы**| 2–3 RPS (зависит от объёма) | 80% → успех, 15% → калибровка (повтор), 5% → ошибка (списание) |
| **Станция варки тапиоки**| 8–12 с на порцию         | Независимый цикл. При запасе <5 порций запускает варку. 90% успех, 10% брак. |
| **Станция топпингов**   | 1–2 RPS                  | 85% успех, 10% → доработка, 5% → ожидание ингредиентов.    |
| **Контроль качества**   | 0.8–1.2 RPS              | 75% одобрение, 20% → доработка (15 с), 5% → полный пересбор. |
| **Выдача и запайка**    | 1–3 RPS                  | Время упаковки 2–8 с.                                       |

Все обработчики выполняются параллельно. При недостатке ингредиентов или переполнении очередей система приостанавливается (имитация блокировок).

## Технологии

- **Язык:** C# (.NET 8)
- **Многопоточность:** `Task`, `Channel<T>` (или `BlockingCollection<T>`) для очередей, `CancellationToken` для остановки.
- **Конфигурация:** JSON-файл `appsettings.json`.
- **Логирование:** в консоль и текстовый файл `log.txt`.
- **Сбор метрик:** собственные счетчики (длина очередей, время обработки, количество брака и т.д.).

##  Структура проекта
BubbleTeaSimulation/
├── Core/
│ ├── Models/ # DTO и внутренние модели (заказ, ингредиенты)
│ ├── Interfaces/ # Контракты для эмиттеров, обработчиков, очередей
│ └── Services/ # Реализация логики (фасад, менеджер симуляции)
├── Emitters/ # Эмиттеры (генераторы заказов)
├── Handlers/ # Обработчики (станции)
├── Queues/ # Потокобезопасные очереди
├── Configuration/ # Чтение конфигурации (JSON)
├── Logging/ # Логирование в файл и консоль
├── Metrics/ # Сбор и вывод статистики
├── Program.cs # Точка входа, запуск всех потоков
├── appsettings.json # Настройки системы
└── README.md
